parameters:
- name: cluster_name
  type: string

- name: subscription
  type: string

- name: region
  type: string

- name: depends_on
  type: object
  default: ''


steps:
- task: AzureCLI@1
  dependsOn: ${{ parameters.depends_on }}
  inputs:
    azureSubscription: $(BUILD_VALIDATIONS_SERVICE_CONNECTION)
    scriptLocation: "inlineScript"
    scriptType: "bash"
    addSpnToEnvironment: true
    inlineScript: |
      echo "Deleting cluster"
      make -C ./hack/aks azcfg AZCLI=az
      make -C ./hack/aks set-kubeconf AZCLI=az
      make -C ./hack/aks down AZCLI=az
      echo "Cluster and resources down"
  displayName: Delete Resources - ${{ parameters.cluster_name }}
  env:
    REGION: ${{ parameters.region }}
    CLUSTER: ${{ parameters.cluster_name }}
    SUB: ${{ parameters.subscription }}
